<app-search></app-search>

<div class="container py-2" *ngIf="product">
    <!-- Breadcrumb -->
    <nav class="mb-2" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item" role="button"><a routerLink="/">Home</a></li>
            <li class="breadcrumb-item" role="button"><a [routerLink]="['/category', product.category]">{{
                    product.category }}</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
        </ol>
    </nav>

    <div class="card shadow-lg rounded p-4">
        <div class="row g-5">
            <!-- Product Image -->
            <div class="col-lg-6 text-center">
                <img [src]="product.imgUrl" [alt]="product.name" class="rounded my-auto w-75 shadow-sm" />
            </div>

            <!-- Product Info -->
            <div class="col-lg-6">
                <h2 class="fw-bold my-2">{{ product.name }}</h2>
                <p class="text-muted">Brand: <strong>{{ product.brand }}</strong></p>
                <p>Category: {{ product.category }}</p>

                <p class="mb-1" [ngClass]="product.available ? 'text-success' : 'text-danger'">
                  {{ product.available ? 'In Stock' : 'Out of Stock' }}
                </p>
                <p *ngIf="product.available" class="text-warning small">Only {{ product.inStock }} left — order soon!</p>

                <!-- Price Display -->
                <div class="my-3">
                    <span *ngIf="product.discount" class="text-muted text-decoration-line-through me-2">₹{{
                        product.price }}</span>
                    <span class="fs-3 fw-bold text-danger">₹{{ getDiscountedPrice(product.price, product.discount) }}</span>
                    <span *ngIf="product.discount" class="text-success ms-2">({{ product.discount }}% off)</span>
                </div>

                <!-- Features -->
                <div *ngIf="product.otherFeatures && (product.otherFeatures | keyvalue).length">
                    <h5 class="mb-2">Key Features:</h5>
                    <ul class="list-unstyled">
                        <li *ngFor="let feature of product.otherFeatures | keyvalue">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <strong>{{ feature.key | titlecase }}:</strong> {{ feature.value }}
                        </li>
                    </ul>
                </div>

                <!-- Quantity & Action Buttons -->
                <div class="mt-4 d-flex flex-column flex-md-row justify-content-around gap-3">
                  <!-- Add to Cart -->
                  <div class="text-center">
                    <div class="input-group mb-2 mx-auto" style="max-width: 200px;">
                      <button class="btn btn-outline-secondary" type="button" (click)="changeQuantity('-')">-</button>
                      <input type="number" class="form-control text-center" [(ngModel)]="quantity" min="1" />
                      <button class="btn btn-outline-secondary" type="button" (click)="changeQuantity('+')">+</button>
                    </div>
                    <button class="btn btn-warning mx-auto" [disabled]="!product.available" (click)="addToCart()" style="height: 40px; width: 200px;">
                      Add to cart
                    </button>
                  </div>

                  <!-- Daily Orders -->
                  <div class="text-center">
                    <div class="input-group mb-2 mx-auto" style="max-width: 200px;">
                      <button class="btn btn-outline-secondary" type="button" (click)="changeDailyQuantity('-')">-</button>
                      <input type="number" class="form-control text-center" [(ngModel)]="dailyQuantity" min="1" />
                      <button class="btn btn-outline-secondary" type="button" (click)="changeDailyQuantity('+')">+</button>
                    </div>
                    <button class="btn btn-warning mx-auto" [disabled]="!product.available" (click)="addToDailyOrders()" style="height: 40px; min-width: 200px;">
                      Add to daily orders
                    </button>
                  </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Product Tabs -->
<div class="card shadow-lg rounded p-4 mt-5">
    <ul class="nav nav-tabs mb-4 justify-content-center" id="productTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="desc-tab" data-bs-toggle="tab" data-bs-target="#description"
          type="button" role="tab">Description</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="specs-tab" data-bs-toggle="tab" data-bs-target="#specifications"
          type="button" role="tab">Specifications</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews"
          type="button" role="tab">Reviews ({{ product.reviews?.length || 0 }})</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="shipping-tab" data-bs-toggle="tab" data-bs-target="#shipping"
          type="button" role="tab">Shipping</button>
      </li>
    </ul>
  
    <div class="tab-content" id="productTabsContent">
      <!-- Description -->
      <div class="tab-pane fade show active" id="description" role="tabpanel">
        <h4>Product Description</h4>
        <p>{{ product.description }}</p>
        <!-- <h5 class="mt-3">What's in the Box:</h5> -->
        <!-- <ul>
          <li *ngFor="let item of product.boxContents">{{ item }}</li>
        </ul> -->
      </div>
  
      <!-- Specifications -->
      <div class="tab-pane fade" id="specifications" role="tabpanel">
        <h4>Specifications</h4>
        <table class="table table-striped" *ngIf="product.specifications">
          <tr *ngFor="let spec of objectEntries(product.specifications[0])">
            <th class="w-50">{{ formatKey(spec[0]) }}</th>
            <td>{{ spec[1] ? spec[1] : '' | titlecase }}</td>
          </tr>
        </table>
      </div>
  
      <!-- Reviews -->
      <div class="tab-pane fade" id="reviews" role="tabpanel">
        <div *ngIf="product?.reviews && product!.reviews?.length; else noReviews">
          <div *ngFor="let review of product!.reviews" class="mb-4 border-bottom pb-3">
            <div class="d-flex justify-content-between">
              <div>
                <strong>{{ review.name }}</strong>
                <div class="text-warning">{{ '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating) }}</div>
              </div>
              <small class="text-muted">{{ review.date | date }}</small>
            </div>
            <p class="mt-2">{{ review.comment }}</p>
          </div>
        </div>
        <ng-template #noReviews>
          <p>No reviews yet.</p>
        </ng-template>
      </div>
  
      <!-- Shipping -->
      <div class="tab-pane fade" id="shipping" role="tabpanel">
        <h4>Shipping Information</h4>
        <ul>
          <li><strong>Free Standard Shipping:</strong> 2-4 business days</li>
          <li><strong>Express Shipping:</strong> 1-2 business days ($9.99)</li>
          <li><strong>Next Day Delivery:</strong> Order by 2 PM ($19.99)</li>
        </ul>
        <h5 class="mt-3">Return Policy</h5>
        <p>30-day return policy. Items must be in original condition with all accessories included.</p>
      </div>
    </div>
  </div>
  

    <!-- Related Products -->
    <div class="mt-5">
        <app-productlist [productDetails]="{ category: product.category }"
            (selectedProduct)="onLoad()"></app-productlist>
    </div>
</div>