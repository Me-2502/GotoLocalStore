<button class="filter-toggle d-md-none rounded-end" (click)="toggleSidebar()" [class.open]="isSidebarOpen" aria-label="Toggle filters">
  <i class="bi" [ngClass]="isSidebarOpen ? 'bi-arrow-left' : 'bi-arrow-right'"></i>
</button>

<div class="overlay" *ngIf="isSidebarOpen" (click)="toggleSidebar()"></div>

<!-- Sidebar Container -->
<div class="filter-sidebar-container" [class.open]="isSidebarOpen">
  <div class="card me-3 p-3 filter-sidebar" style="max-width: 300px;">
    <h5 class="mb-3 d-flex justify-content-between align-items-center">
      Filters
      <!-- Close Button on mobile -->
      <button class="btn-close d-md-none" (click)="toggleSidebar()"></button>
    </h5>
    
    <!-- Search -->
    <div class="mb-4">
        <label class="form-label fw-semibold">Search</label>
        <input type="text" class="form-control" [(ngModel)]="filters.searchText" placeholder="Search by name" style="max-width: 250px;" />
    </div>

    <!-- Category Checklist -->
    <div class="mb-4" *ngIf="categories.length > 1">
        <label class="form-label fw-semibold">Category</label>
        <div class="overflow-auto" style="max-height: 150px;">
            <div *ngFor="let cat of categories" class="form-check">
                <input class="form-check-input" type="checkbox" [checked]="filters.category?.includes(cat)"
                (change)="toggleCategory(cat, $event)" id="cat-{{ cat }}" />
                <label class="form-check-label" for="cat-{{ cat }}">{{ cat | titlecase }}</label>
            </div>
        </div>
    </div>

    <!-- Brand Checklist -->
    <div class="mb-4">
        <label class="form-label fw-semibold">Brand</label>
        <div class="overflow-auto" style="max-height: 150px;">
            <div *ngFor="let brand of brands" class="form-check">
                <input class="form-check-input" type="checkbox" [checked]="filters.brand?.includes(brand)"
                (change)="toggleBrand(brand, $event)" id="brand-{{ brand }}" />
                <label class="form-check-label" for="brand-{{ brand }}">{{ brand | titlecase }}</label>
            </div>
        </div>
    </div>

    <!-- Price Range -->
    <div class="mb-4">
        <label class="form-label fw-semibold">Price Range</label>
        <div class="d-flex gap-2">
            <input type="number" class="form-control" placeholder="Min" style="max-width: 120px;" [(ngModel)]="filters.minPrice" />
            <input type="number" class="form-control" placeholder="Max" style="max-width: 120px;" [(ngModel)]="filters.maxPrice" />
        </div>
    </div>

    <!-- Availability -->
    <div class="mb-4">
        <label class="form-label fw-semibold">Availability</label>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="availability" value="" [(ngModel)]="filters.availability"
                id="availAll" />
            <label class="form-check-label" for="availAll">All</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="availability" value="true"
                [(ngModel)]="filters.availability" id="availInStock" />
            <label class="form-check-label" for="availInStock">In Stock</label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="availability" value="false"
                [(ngModel)]="filters.availability" id="availOutStock" />
            <label class="form-check-label" for="availOutStock">Out of Stock</label>
        </div>
    </div>

    <!-- Dynamic Filters -->
    <div *ngFor="let filter of objectKeys(dynamicFilters)">
        <div *ngIf="dynamicFilters[filter][0]">
            <label class="form-label fw-semibold">{{ filter | titlecase }}</label>
            <div class="overflow-auto" style="max-height: 150px;">
                <div *ngFor="let option of dynamicFilters[filter]" class="form-check">
                    <input class="form-check-input" type="checkbox" [checked]="filters.filter?.includes(option)"
                    (change)="toggleDynamicFilter(filter, option, $event)" id="{{filter}}-{{ option }}" />
                    <label class="form-check-label" for="{{filter}}-{{ option }}">{{ option | titlecase }}</label>
                </div>
            </div>
        </div>
    </div>

    <!-- Buttons -->
    <div class="d-flex gap-2 mt-4">
        <button class="btn btn-primary flex-fill" (click)="applyFilters()">Apply</button>
        <button class="btn btn-outline-secondary flex-fill" (click)="resetFilters()">Reset</button>
    </div>
  </div>
</div>
